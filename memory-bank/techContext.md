# 技術コンテキスト

## 使用技術

### フロントエンド

*   **言語**: TypeScript
*   **フレームワーク**: Next.js (App Router)
*   **描画ライブラリ**: React Flow
*   **状態管理**: Zustand（実装完了）
*   **スタイリング**: Tailwind CSS (+ shadcn/ui)
*   **パッケージマネージャー**: pnpm

### バックエンド

*   **言語/ランタイム**: Python (uv)
*   **Webフレームワーク**: FastAPI
*   **ORM**: SQLAlchemy（非同期対応）
*   **データベースマイグレーション**: Alembic
*   **LLM呼び出し**: OpenAI, Azure OpenAI, Anthropic Claude, Google Gemini, Ollamaなど、複数のLLMプロバイダーに対応

### データベース

*   **開発環境**: SQLite
*   **本番環境**: PostgreSQL（予定）

## 開発セットアップ

*   **ディレクトリ構造**:
    *   `frontend/`: フロントエンド関連の処理を格納します。
    *   `backend/`: バックエンド関連の処理を格納します。

*   **ワンショット起動**:
    *   ルートディレクトリで`npm run dev`を実行すると、concurrentlyによりフロントエンドとバックエンドが同時起動
    *   フロントエンド: http://localhost:3000（ポート競合時は3001、3002等に自動変更）
    *   バックエンド: http://localhost:8000（ポート競合時は手動で8001等に変更）

## 技術的制約

*   LLMへの入力は、選択されたノードから根までの会話履歴に限定され、`max_tokens`の制約内でtruncateされる必要があります。
*   リアルタイムなチャット体験を提供するため、フロントエンドとバックエンド間の通信は低遅延である必要があります（WebSocket/SSEの採用予定）。
*   チャット履歴のタイトルは最初のメッセージの10文字に自動設定されます。

## 依存関係

*   **フロントエンド**: Next.js、React Flow、Zustand、Tailwind CSS、shadcn/ui、pnpm
*   **バックエンド**: FastAPI、SQLAlchemy、Alembic、および各LLMプロバイダーのSDK（openai、anthropic、google-generativeai等）
*   **データベース**: 開発環境ではSQLite、本番環境ではPostgreSQL

## ツール使用パターン

*   **開発**: 
    *   `uv` (Pythonのパッケージ管理・実行ツール) を使用してバックエンドの依存関係を管理し、開発サーバーを起動
    *   `pnpm` を使用してフロントエンドの依存関係を管理し、開発サーバーを起動
    *   `npm run dev` でフロントエンドとバックエンドを同時起動
*   **データベース**: Alembicを使用してデータベーススキーマの変更を適用・管理
*   **LLMプロバイダー**: 統一インターフェースで5つのプロバイダー（OpenAI、Azure、Gemini、Claude、Ollama）を管理

## 実装済み機能の技術詳細

### 会話分岐システム
*   **データベース設計**: parent_idによるツリー構造
*   **フロントエンド**: React Flowによる視覚的ツリー表示
*   **状態管理**: Zustandによる会話ノード管理

### LLMプロバイダー統合
*   **プロバイダー抽象化**: 統一インターフェースで複数プロバイダー対応
*   **設定管理**: プロバイダータイプベースの設定システム
*   **エラーハンドリング**: プロバイダー固有のエラー処理

### チャット履歴管理
*   **自動タイトル生成**: 最初のメッセージの10文字を使用
*   **履歴永続化**: SQLiteデータベースによる永続化
*   **リアルタイム更新**: API連携による即座の反映

### 設定システム
*   **ローカル永続化**: localStorage + バージョン管理
*   **バックエンド連携**: RESTful APIによる設定同期
*   **型安全性**: TypeScript + Pydanticによる型チェック
